/**
 * Kollus.VideogatewayController
 * version: v0.0.5
 *
 * includes: Kollus.PostMessage <v0.0.2>, Kollus.Utility <v0.0.1>
 * throws : KollusVideogatewayControllerException, KollusPostMessageException, KollusException
 */
!function(e){"function"==typeof define&&define.amd?define(e()):"object"==typeof exports?e.exports=e():("undefined"==typeof window.Kollus&&(window.Kollus={}),window.Kollus.Utility=e())}(function(){var e=window.KollusException=function(e,t){this.message=e,this.code=t||-1,this.toString=function(){return this.message+" ["+this.code+"]"}};Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,o=function(){},i=function(){return n.apply(this instanceof o&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return o.prototype=this.prototype,i.prototype=new o,i});var t={};t.merge_object=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e};var n=function(e){this.options=t.merge_object({scope:"*",use_log:!1},e||{})};n.prototype.log=function(e,t,n){this.options.use_log===!0&&"undefined"!=typeof window.console&&console.log((new Date).toLocaleString()+" - "+e+": ["+this.options.scope+"/"+t+"] "+n)},n.prototype.info=function(e,t){this.log("info",e,t)},n.prototype.debug=function(e,t){this.log("debug",e,t)},n.prototype.error=function(e,t){this.log("error",e,t)},t.create_logger=function(e){return new n(e)};var o=0;t.uid=function(e){return(e||"kollus")+"-"+o++},t.listen=function(t,n){if("function"!=typeof n)throw new e("listener is not callable.",-1);return{to:function(o){if(o.addEventListener)o.addEventListener(t,n,!1);else{if(!o.attachEvent)throw new e("object does not support event.",-1);o.attachEvent("on"+t,n)}}}};var i=function(){this.listeners={}};return i.prototype.on=function(t,n){if("function"!=typeof n)throw new e("listener is not callable.",-1);return"undefined"==typeof this.listeners[t]&&(this.listeners[t]=[]),this.listeners[t].push(n),this},i.prototype.trigger=function(){if(arguments.length>=1){var e=Array.prototype.slice.call(arguments),t=e.shift();if("undefined"!=typeof this.listeners[t])for(var n=0,o=this.listeners[t].length;o>n;n++)this.listeners[t][n].apply(this,e)}},t.create_event_dispatcher=function(){return new i},t.make_fullscreen=function(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()},t});!function(t){"function"==typeof define&&define.amd?define(t()):"object"==typeof exports?t.exports=t():("undefined"==typeof window.Kollus&&(window.Kollus={}),window.Kollus.PostMessage=t())}(function(){var t="v0.0.2",e=!1,i=Kollus.Utility.create_logger({scope:"PostMessage",use_log:e}),s=window.KollusPostMessageException=function(t,e){this.message=t,this.code=e||-1,this.toString=function(){return this.message+" ["+this.code+"]"}},o=function(e){if(e.is_child?i.options.scope="<<<---"+i.options.scope:i.options.scope="--->>>"+i.options.scope,i.info("SCRIPT_VERSION",t),this.options=Kollus.Utility.merge_object({target_window:null,target_origin:"*",use_uid_check:!0,is_child:!1},e||{}),this.event_dispatcher=new Kollus.Utility.create_event_dispatcher,this.uid=null,this.options.use_uid_check&&(this.uid=Kollus.Utility.uid("kollus-postmessage")),"undefined"==typeof window.postMessage)throw new s("this browser does not support postMessage",-99);try{Kollus.Utility.listen("message",this.receive.bind(this)).to(window)}catch(o){throw new s("can`t attach event to window.",-99)}};return o.prototype.on=function(t,e){try{this.event_dispatcher.on(t,e)}catch(i){throw i}return this},o.prototype.send=function(t,e){return i.debug("send","event_name -> "+t+", data -> "+e),null!==this.options.target_window?this.options.target_window.postMessage(JSON.stringify({event_name:t,data:"undefined"!=typeof e?e:!0,uid:this.uid}),this.options.target_origin):!1},o.prototype.receive=function(t){if("*"!==this.options.target_origin&&this.options.target_origin!==t.origin)return i.debug("receive","event received, but origin not match. (target_origin: "+this.options.target_origin+", event.origin: "+t.origin+")"),!1;try{i.debug("receive",t.data);var e=JSON.parse(t.data);if(this.options.use_uid_check===!0&&this.uid!==e.uid)return i.debug("receive","not matched uid. this.uid -> "+this.uid+", message.uid -> "+e.uid),!1;this.options.use_uid_check===!1&&null===this.uid&&(i.debug("receive","no use_uid_check. message.uid will be set to this.uid. mesasge.uid -> "+e.uid),this.uid=e.uid),this.options.is_child&&null===this.options.target_window&&(i.debug("receive","this window is child. target_window will be set as event.source."),this.options.target_window=t.source),this.event_dispatcher.trigger(e.event_name,e.data)}catch(o){throw new s(o.message,-1)}},o});!function(t){"function"==typeof define&&define.amd?define(t()):"object"==typeof exports?t.exports=t():("undefined"==typeof window.Kollus&&(window.Kollus={}),window.Kollus.VideogatewayController=t())}(function(){var t="v0.0.5",e=!1,s=Kollus.Utility.create_logger({scope:"VideogatewayController",use_log:e}),o=(window.KollusVideogatewayControllerException=function(t,e){this.message=t,this.code=e||-1,this.toString=function(){return this.message+" ["+this.code+"]"}},function(e){s.info("SCRIPT_VERSION",t);var o=this;this.status={progress:{percent:0,position:0,duration:0},screen:"windowed",volume:50,muted:!1,jumpstep:10,scalemode:"letterbox",control_visibility:!0,speed:1,topmost:!1,video:{brightness:0,contrast:0,saturation:0},player_id:null},this.postmessage=new Kollus.PostMessage(e);var n=!1,i=0,r=50,a=setInterval(function(){++i>=r&&(clearInterval(a),s.debug("initialized","max initialize try reached.")),n===!0?(clearInterval(a),s.debug("initialized","receive initialized & clear interval function.")):(o.postmessage.send("c_initialize",!0),s.debug("initialize","send initialize command."))},100);this.event_dispatcher=Kollus.Utility.create_event_dispatcher(),this.postmessage.on("e_initialized",function(){n=!0}).on("e_progress",function(t){o.status.progress=Kollus.Utility.merge_object(o.status.progress,t),o.event_dispatcher.trigger("progress",1*t.percent,1*t.position,1*t.duration)}).on("e_screenchange",function(t){o.status.screen=t,o.event_dispatcher.trigger("screenchange",t)}).on("e_volumechange",function(t){o.status.volume=1*t,o.event_dispatcher.trigger("volumechange",1*t)}).on("e_muted",function(t){o.status.muted=t,o.event_dispatcher.trigger("muted",t)}).on("e_play",function(){o.event_dispatcher.trigger("play")}).on("e_pause",function(){o.event_dispatcher.trigger("pause")}).on("e_done",function(){o.event_dispatcher.trigger("done")}).on("e_ready",function(){o.event_dispatcher.trigger("ready")}).on("e_loaded",function(){o.event_dispatcher.trigger("loaded")}).on("e_jumpstepchange",function(t){o.status.jumpstep=1*t,o.event_dispatcher.trigger("jumpstepchange",1*t)}).on("e_scalemode",function(t){o.status.scalemode=t,o.event_dispatcher.trigger("scalemodechange",t)}).on("e_speedchange",function(t){o.status.speed=t,o.event_dispatcher.trigger("speedchange",t)}).on("e_topmost",function(t){o.status.topmost=t,o.event_dispatcher.trigger("topmostchange",t)}).on("e_videosettingchange",function(t){o.status.video=Kollus.Utility.merge_object(o.status.video,t),o.event_dispatcher.trigger("videosettingchange",t)}).on("e_html5_video_supported",function(t){o.event_dispatcher.trigger("html5_video_supported",t)}).on("e_error",function(t){o.event_dispatcher.trigger("error",t)}).on("e_fetch_player_id",function(t){o.status.player_id=t})});return o.prototype.on=function(t,e){return this.event_dispatcher.on(t,e),this},o.prototype.get_progress=function(){return this.status.progress},o.prototype.play=function(t){this.postmessage.send("c_play",t||0)},o.prototype.pause=function(){this.postmessage.send("c_pause")},o.prototype.set_volume=function(t){this.postmessage.send("c_set_volume",Math.min(100,Math.max(0,t)))},o.prototype.get_volume=function(){return this.status.volume},o.prototype.mute=function(){this.postmessage.send("c_mute")},o.prototype.ff=function(){this.postmessage.send("c_ff")},o.prototype.rw=function(){this.postmessage.send("c_rw")},o.prototype.set_screen=function(){this.postmessage.send("c_set_screen")},o.prototype.get_screen=function(){return this.status.screen},o.prototype.set_jumpstep=function(t){this.postmessage.send("c_set_jumpstep",1*t)},o.prototype.get_jumpstep=function(){return this.status.jumpstep},o.prototype.set_control_visibility=function(t){this.postmessage.send("c_set_control_visibility",t),this.status.control_visibility=t},o.prototype.get_control_visibility=function(){return this.status.control_visibility},o.prototype.set_scalemode=function(t){"|letterbox|stretch|zoom|none|".indexOf(t)>=0&&this.postmessage.send("c_set_scalemode",t)},o.prototype.get_scalemode=function(){return this.status.scalemode},o.prototype.set_speed=function(t){this.postmessage.send("c_set_speed",parseFloat(Math.min(2,Math.max(.5,t))).toFixed(1))},o.prototype.get_speed=function(){return this.status.speed},o.prototype.set_topmost=function(t){this.postmessage.send("c_set_topmost",t?1:0)},o.prototype.get_topmost=function(){return this.status.topmost},o.prototype.set_brightness=function(t){this.postmessage.send("c_set_brightness",Math.min(50,Math.max(-50,t)))},o.prototype.get_brightness=function(){return this.status.video.brightness},o.prototype.set_contrast=function(t){this.postmessage.send("c_set_contrast",Math.min(50,Math.max(-50,t)))},o.prototype.get_contrast=function(){return this.status.video.contrast},o.prototype.set_saturation=function(t){this.postmessage.send("c_set_saturation",Math.min(50,Math.max(-50,t)))},o.prototype.get_saturation=function(){return this.status.video.saturation},o.prototype.set_repeat_start=function(t){this.postmessage.send("c_set_sectiontime",{type:1,value:t||-1})},o.prototype.set_repeat_end=function(t){this.postmessage.send("c_set_sectiontime",{type:2,value:t||-1})},o.prototype.unset_repeat=function(){this.postmessage.send("c_set_sectiontime",{type:0,value:-1})},o.prototype.refresh_bookmark=function(){this.postmessage.send("c_refresh_bookmark")},o.prototype.enable_fullscreen_button=function(){this.postmessage.send("c_enable_fullscreen_button")},o.prototype.get_player_id=function(){return this.status.player_id},o});